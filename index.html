<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TJ ì„¼í„° ë¹ ë¥¸ê²€ìƒ‰</title>
<meta name="theme-color" content="#ffffff"/>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif;margin:0;padding:20px;background:#fff;}
  h1{font-size:22px;margin:0 0 14px 0;}
  input{width:100%;font-size:22px;padding:16px;border:1px solid #ccc;border-radius:16px;margin-bottom:12px;}
  button{font-size:20px;padding:16px;border:0;border-radius:16px;cursor:pointer;}
  .row{display:flex;gap:10px;margin-bottom:10px;}
  .row button{flex:1;}
  .section{margin-top:18px;}
  .list button{width:100%;text-align:left;margin-bottom:8px;background:#f3f3f3;}
  .small{font-size:14px;opacity:.75;line-height:1.4;margin-top:10px;}
</style>
</head>
<body>

<h1>ğŸ¤ TJ ì„¼í„° ë¹ ë¥¸ê²€ìƒ‰</h1>

<input id="q" placeholder="ê³¡ ì œëª© / ê°€ìˆ˜ ì…ë ¥ í›„ â€˜ì´ë™(Enter)â€™ ëˆ„ë¥´ì„¸ìš”" inputmode="search" />

<div class="row">
  <button id="copyOpen">ğŸ” ë³µì‚¬ + TJì—´ê¸°</button>
  <button id="clear">ğŸ§¹ ì§€ìš°ê¸°</button>
</div>

<div class="row">
  <button id="favSave">â­ ì¦ê²¨ì°¾ê¸° ì¶”ê°€</button>
  <button id="select">ğŸŸ¦ ì„ íƒ(ë¶™ì—¬ë„£ê¸°ìš©)</button>
</div>

<div class="section">
  <h3>â­ ì¦ê²¨ì°¾ê¸°</h3>
  <div id="favorites" class="list"></div>
</div>

<div class="section">
  <h3>ğŸ•˜ ìµœê·¼ ê²€ìƒ‰</h3>
  <div id="recent" class="list"></div>
</div>

<p class="small">
âœ… ì‚¬ìš©: ê³¡ëª… ì…ë ¥ â†’ <b>í‚¤ë³´ë“œ â€˜ì´ë™/Enterâ€™</b> ë˜ëŠ” <b>ë³µì‚¬+TJì—´ê¸°</b><br/>
â€» ë³µì‚¬ê°€ ë§‰íˆë©´ <b>ì„ íƒ(ë¶™ì—¬ë„£ê¸°ìš©)</b> ëˆŒëŸ¬ì„œ íŒŒë€ìƒ‰ìœ¼ë¡œ ì¡íŒ ìƒíƒœë¡œ TJì—ì„œ ë¶™ì—¬ë„£ê¸° í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
</p>

<script>
  const q = document.getElementById('q');
  const favBox = document.getElementById('favorites');
  const recentBox = document.getElementById('recent');

  function load(key){ return JSON.parse(localStorage.getItem(key)||'[]'); }
  function save(key, arr){ localStorage.setItem(key, JSON.stringify(arr)); }

  function saveRecent(text){
    let arr = load('recent').filter(v => v !== text);
    arr.unshift(text);
    arr = arr.slice(0, 10);
    save('recent', arr);
    renderRecent();
  }

  function saveFav(text){
    let arr = load('fav');
    if(!arr.includes(text)){
      arr.unshift(text);
      save('fav', arr);
    }
    renderFav();
  }

  function renderRecent(){
    const arr = load('recent');
    recentBox.innerHTML = '';
    arr.forEach(text=>{
      const b=document.createElement('button');
      b.textContent=text;
      b.onclick=()=>{ q.value=text; q.focus(); };
      recentBox.appendChild(b);
    });
  }

  function renderFav(){
    const arr = load('fav');
    favBox.innerHTML = '';
    arr.forEach(text=>{
      const wrap = document.createElement('div');
      wrap.style.display = 'flex';
      wrap.style.gap = '8px';
      wrap.style.marginBottom = '8px';

      const b=document.createElement('button');
      b.textContent=text;
      b.style.flex='1';
      b.style.background='#f3f3f3';
      b.onclick=()=>{ q.value=text; q.focus(); };

      const del=document.createElement('button');
      del.textContent='ğŸ—‘';
      del.style.width='64px';
      del.onclick=()=>{
        const next = load('fav').filter(v=>v!==text);
        save('fav', next);
        renderFav();
      };

      wrap.appendChild(b);
      wrap.appendChild(del);
      favBox.appendChild(wrap);
    });
  }

  async function copyToClipboard(text){
    // 1) ìµœì‹  clipboard API
    try{
      await navigator.clipboard.writeText(text);
      return true;
    }catch(e){}
    // 2) ëŒ€ì²´ ë°©ì‹
    try{
      q.focus();
      q.select();
      const ok = document.execCommand('copy');
      return ok;
    }catch(e){}
    return false;
  }

  function openTJ(){
    window.open('https://www.tjmedia.com/song/accompaniment', '_blank');
  }

  async function go(){
    const text = q.value.trim();
    if(!text) return alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
    saveRecent(text);
    const ok = await copyToClipboard(text);
    openTJ();
    if(!ok){
      // ë³µì‚¬ ì‹¤íŒ¨ ëŒ€ë¹„: ì„ íƒ ìƒíƒœ ìœ ì§€
      q.focus();
      q.select();
      alert('ë³µì‚¬ê°€ ë§‰í˜”ì–´ìš”. íŒŒë€ìƒ‰ìœ¼ë¡œ ì„ íƒëœ ìƒíƒœì—ì„œ TJì—ì„œ ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.');
    }
  }

  document.getElementById('copyOpen').onclick = go;

  document.getElementById('clear').onclick = ()=>{
    q.value='';
    q.focus();
  };

  document.getElementById('favSave').onclick = ()=>{
    const text=q.value.trim();
    if(!text) return alert('ì¦ê²¨ì°¾ê¸°ì— ë„£ì„ ê³¡ëª…ì„ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.');
    saveFav(text);
  };

  document.getElementById('select').onclick = ()=>{
    q.focus();
    q.select();
  };

  // âœ… í•µì‹¬: í‚¤ë³´ë“œ â€˜ì´ë™/Enterâ€™ ëˆ„ë¥´ë©´ ìë™ ì‹¤í–‰
  q.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter'){
      e.preventDefault();
      go();
    }
  });

  renderRecent();
  renderFav();
  q.focus();
</script>

</body>
</html>
